## 了解 Web 及网络

- http 协议处于应用层

### TPC/IP 协议群

- DNS 负责域名解析
- TCP ：将每个报文分割成报文段，把每个报文段可靠的传输给对方
- IP 协议：搜索对方的地址，一边中转一边发送（通过路由器进行中转）
- TCP 三次握手会用到他的标识：SYN、ACK
- TCP 三次握手：发送端：--SYN--> 接收端 --SYN/ACK--> 发送端 --ACK-->接收端

## 简单的 http 协议

- http 本身不保存状态，这是为了更快的处理事务并且保持协议的可拓展性
  - http 为了实现保持状态功能，引入了 Cookie

### HTTP 1.1 中可使用的方法

- GET： 用来请求访问已被 URI 识别的资源（获取资源）
- POST：用来传输实体的主体
- PUT：传输文件
  - 鉴于 HTTP/1.1 PUT 方法自身没有验证机制，任何人都可以上传文件，存在安全性问题，所以一般的 Web 网站不使用该方法
  - 若配合 Web 应用程序的验证机制，或架构设计采用 REST 标准的同类 Web 网站，就可能开放 PUT 方法
- HEAD：获取报文首部
  - 和 GET 方法一样，但是不返回报文主体部分用于确认 URI 的有效性及资源更新的日期时间等
- DELETE：删除文件
- OPTIONS：询问支持的方法
- TRACE：追踪路径（让 Web 服务端将之前的请求通信环回给客户端的方法）
- CONNECT：要求用隧道协议连接代理

### 持久连接

- 持久连接旨在建立 1 次 TCP 连接后进行多次请求和响应的交互
- 好处：
  - 减少了 TCP 连接的出发建立和断开造成的额外开销，减轻了服务端的负载
  - HTTP 请求和响应能够更快的结束，Web 页面的现实速度也就变快了
- HTTP/1.1 所有连接默认都是持久连接
- 管线化：管线化技术使得不用等待响应就可直接发送下一个请求，这样就能够做到并行发送多个请求，不需要一个接一个的等待响应

### 使用 Cookie 进行状态管理

- 第一次请求：
  - 客户端 --- 请求---- > 服务端( 生成 Cookie，记住是向谁发送的 )
  - 客户端 < --- 响应( 在响应中添加 Cookie )---- 服务端
- 第二次请求：
  - 客户端 --- 请求( 在响应中添加 Cookie )---- > 服务端( 检查 Cookie)

## HTTP 报文内的 HTTP 信息

- 报文主体和实体主体的差异
  - 报文（message）
    - 是 HTTP 通信中的基本单位，由 8 位组字节流组成，通过 HTTP 通信传输
  - 实体（entity）
    - 作为请求或相应的有效载荷数据（补充项）被传输，期内容由实体首部和实体主体组成
  - HTTP 报文的主体用于传输请求或响应的实体主体。
  - 通常，报文主体等于实体主体。只有当传输中进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异。

## 返回结果的 HTTP 状态码

- 状态码的职责：告知服务端返回的请求结果
  - 正常：状态码 1xx
  - 错误：状态码 4xx、5xx
  - 状态码的类别
    |状态码 |类别 | 原因短语|
    |:---|:---:|---:|
    |1XX|信息性状态码|接受的请求正在处理|
    |2XX|成功状态码|请求正常处理完毕|
    |3XX|重定向状态码|需要进行附加操作以完成请求|
    |4XX|客户端错误状态码|服务器无法处理请求|
    |5XX|服务器错误状态码|服务器处理请求出错|

### 常用的 14 种状态码

- 2XX 的响应结果表示请求被正常处理了
  - 200 OK ：客户端发来的请求在服务器端被正常处理了
  - 204 No Content ：代表服务器接受的请求已成功处理，但是返回的响应报文中不含实体的主体部分
  - 206 Partial Content：表示客户端进行了范围请求，而服务器成功执行了这部分的 GET 请求
- 3XX 重定向：表示浏览器需要执行某些特殊的处理以正确处理请求
  - 301 永久重定向，访问资源的 URL 永久性的更改了，浏览器会对其进行缓存，不在访问老 URL
  - 302 临时重定向，访问资源的 URL 暂时性修改了，浏览器不会对其进行缓存，下次还会继续请求老 URL
  - 303 表示由于请求对应的资源存在另外一个 URL，应使用 GET 方法定向请求新的资源
  - 304 表示客户端发送附带条件的请求时，服务端允许请求访问资源，但为满足条件的情况，304 状态码返回时，不包含任何响应的主体部分（304 和重定向没关系）
- 4XX 客户端错误：表明客户端是发生错误的原因所在
  - 400 表示请求报文中存在语法错误，需修改请求内容再次发送请求
  - 401 表示发送的请求需要有通过 HTTP 认证（BASIC、DIGEST 认证）的认证信息。若之前已进行过一次请求，则表示用户认证失败
  - 403 表示对请求资源的访问被服务器拒绝了。服务器可以在实体的主体部分进行原因的描述（未获得文件习题的访问授权，访问权限出现某些问题都可能发生 403）
  - 404 表示服务器上无法找到请求的资源。初次之外，也可以在服务器端拒绝请求且不想说明理由时使用。
- 5XX 服务器错误：表明服务器本省发生错误
  - 500 表明服务端在执行请求时发生了错误。也有可能是 WEB 应用存在的 bug 或某些临时的故障
  - 503 表明服务器暂时处于超负载或正在进行挺近维护，现在无法处理请求。

## 与 HTTP 协作的 WEB 服务器

### 通信数据转发程序：代理、网关、隧道

- 代理：代理是一种有转发功能的应用程序，它扮演了位于服务器和客户端‘中间人’的角色，接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应再转发给客户端。
- 网关：网关是转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理
- 隧道：隧道是在相隔甚远的客户端和服务端两者之间进行中转，斌保持双方通信连接的应用程序

#### 代理

代理服务器的基本行为就是接收客户端发送的请求后转发给其他服务器。代理不改变请求 URL，会直接发送给前方持有资源的目标服务器。

持有资源实体的服务器被称为源服务器。从源服务器返回的响应经过代理服务器后再传给客户端。

- 使用代理服务器的理由：利用缓存技术减少网络带宽的流量，组织内部针对特定网站的访问控制，以获取访问日志为主要目的，等等
- 代理服务器的使用方法，按两种基准分类。一种是是否使用缓存，另一种是是否会修改报文
  - 缓存代理：代理再次接收相同资源的请求时，不从源服务器中获取资源，而是将缓存的资源作为响应返回，减轻后端的压力
  - 透明代理：转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理

#### 网关

- 利用网管可以将 HTTP 请求转化为其他协议通信
- 利用网关可以提高通信的安全性（可以在客户端和网关之间的通信线路上加密以确保连接的安全）

#### 隧道

- 按要求建立一个与其他服务器的通信线路，届时使用 SSL 等加密手段进行通信
- 隧道的母的是确保客户端与服务器进行安全的通信

#### 缓存

- 代理和浏览器都有缓存
- 缓存存在有效期
  - 即使存在缓存，代理或者浏览器都会像源服务器确认缓存的有效性
